function captureElements(e,t){const r=t+2;return{name:e.querySelector(`tr.name-row td:nth-child(${r}) input.name-input`),unitsPerShipment:e.querySelector(`tr.units-per-shipment-row td:nth-child(${r}) input`),currency:e.querySelector(`tr.currency-row td:nth-child(${r}) select`),productionCosts:e.querySelector(`tr.production-costs-row td:nth-child(${r}) input`),manufacturerMargin:e.querySelector(`tr.manufacturer-margin-row td:nth-child(${r}) input`),manufacturerMarginValue:e.querySelector(`tr.manufacturer-margin-row td:nth-child(${r}) .manufacturer-margin-value`),manufacturerMarginPrice:e.querySelector(`tr.manufacturer-margin-row td:nth-child(${r}) .manufacturer-margin-price`),freightInsurance:e.querySelector(`tr.freight-insurance-row td:nth-child(${r}) input`),cogsTotal:e.querySelector(`tr.cogs-heading td:nth-child(${r}) .cogs-total`),freightInsurancePrice:e.querySelector(`tr.freight-insurance-row td:nth-child(${r}) .freight-insurance-price`),customDuties:e.querySelector(`tr.custom-duties-row td:nth-child(${r}) input`),customDutiesValue:e.querySelector(`tr.custom-duties-row td:nth-child(${r}) .custom-duties-value`),customDutiesPrice:e.querySelector(`tr.custom-duties-row td:nth-child(${r}) .custom-duties-price`),exciseTax:e.querySelector(`tr.excise-tax-row td:nth-child(${r}) input`),exciseTaxValue:e.querySelector(`tr.excise-tax-row td:nth-child(${r}) .excise-tax-value`),exciseTaxPrice:e.querySelector(`tr.excise-tax-row td:nth-child(${r}) .excise-tax-price`),domesticLogistics:e.querySelector(`tr.domestic-logistics-row td:nth-child(${r}) input`),domesticLogisticsPrice:e.querySelector(`tr.domestic-logistics-row td:nth-child(${r}) .domestic-logistics-price`),storage:e.querySelector(`tr.storage-row td:nth-child(${r}) input`),storagePrice:e.querySelector(`tr.storage-row td:nth-child(${r}) .storage-price`),importHandling:e.querySelector(`tr.import-handling-row td:nth-child(${r}) input`),importHandlingPrice:e.querySelector(`tr.import-handling-row td:nth-child(${r}) .import-handling-price`),importerMargin:e.querySelector(`tr.importer-margin-row td:nth-child(${r}) input`),importerMarginValue:e.querySelector(`tr.importer-margin-row td:nth-child(${r}) .importer-margin-value`),importerMarginPrice:e.querySelector(`tr.importer-margin-row td:nth-child(${r}) .importer-margin-price`),wholesalerMargin:e.querySelector(`tr.wholesaler-margin-row td:nth-child(${r}) input`),wholesalerMarginValue:e.querySelector(`tr.wholesaler-margin-row td:nth-child(${r}) .wholesaler-margin-value`),wholesalerMarginPrice:e.querySelector(`tr.wholesaler-margin-row td:nth-child(${r}) .wholesaler-margin-price`),retailerMargin:e.querySelector(`tr.retailer-margin-row td:nth-child(${r}) input`),retailerMarginValue:e.querySelector(`tr.retailer-margin-row td:nth-child(${r}) .retailer-margin-value`),retailerMarginPrice:e.querySelector(`tr.retailer-margin-row td:nth-child(${r}) .retailer-margin-price`),freightInsuranceTotal:e.querySelector(`tr.freight-insurance-heading td:nth-child(${r}) .freight-insurance-total`),dutiesTotal:e.querySelector(`tr.duties-heading td:nth-child(${r}) .duties-total`),cifLogisticsTotal:e.querySelector(`tr.cif-logistics-heading td:nth-child(${r}) .cif-logistics-total`),marginsTotal:e.querySelector(`tr.margins-heading td:nth-child(${r}) .margins-total`),pricePerUnit:e.querySelector(`tr.price-per-unit-row td:nth-child(${r}) span`),pricePerShipment:e.querySelector(`tr.price-per-shipment-row td:nth-child(${r}) span`),deleteButton:e.querySelector(`tr.delete-row td:nth-child(${r}) button`)}}function extractInputs(e){return{name:e.name.value,currency:e.currency.value,unitsPerShipment:parseFloat(e.unitsPerShipment.value)||0,productionCosts:parseFloat(e.productionCosts.value)||0,manufacturerMargin:parseFloat(e.manufacturerMargin.value)||0,freightInsurance:parseFloat(e.freightInsurance.value)||0,customDuties:parseFloat(e.customDuties.value)||0,exciseTax:parseFloat(e.exciseTax.value)||0,domesticLogistics:parseFloat(e.domesticLogistics.value)||0,storage:parseFloat(e.storage.value)||0,importHandling:parseFloat(e.importHandling.value)||0,importerMargin:parseFloat(e.importerMargin.value)||0,wholesalerMargin:parseFloat(e.wholesalerMargin.value)||0,retailerMargin:parseFloat(e.retailerMargin.value)||0}}function calculateOutputs(e){const t=e.productionCosts,r=t/(1-e.manufacturerMargin/100),n=r+e.freightInsurance/e.unitsPerShipment,o=e.customDuties/100*n,i=e.exciseTax,a=n+o+i,c=a+e.domesticLogistics+e.storage+e.importHandling,l=c/(1-e.importerMargin/100),s=l/(1-e.wholesalerMargin/100),u=s/(1-e.retailerMargin/100),d=l-c,p=s-l,m=u-s;return{baseCost:t,exworksPrice:r,cifPrice:n,customDutiesValue:o,exciseTaxValue:i,priceAfterDuties:a,cifLogisticsTotal:c,importerPrice:l,wholesalerPrice:s,retailerPrice:u,importerMarginValue:d,wholesalerMarginValue:p,retailerMarginValue:m,totalMargins:d+p+m+c,pricePerUnit:u,pricePerShipment:u*e.unitsPerShipment}}function renderCalculator(e){const t=e.inputs.currency,r=e.elements,n=e.outputs,o=(e,r)=>{e&&(e.textContent=(e=>new Intl.NumberFormat(void 0,{style:"currency",currency:t}).format(e))(r))};o(r.manufacturerMarginPrice,n.exworksPrice),o(r.cogsTotal,n.exworksPrice),o(r.freightInsurancePrice,n.cifPrice),o(r.customDutiesPrice,n.priceAfterDuties),o(r.exciseTaxPrice,n.priceAfterDuties),o(r.domesticLogisticsPrice,n.cifLogisticsTotal),o(r.storagePrice,n.cifLogisticsTotal),o(r.importHandlingPrice,n.cifLogisticsTotal),o(r.importerMarginPrice,n.importerPrice),o(r.wholesalerMarginPrice,n.wholesalerPrice),o(r.retailerMarginPrice,n.retailerPrice),o(r.freightInsuranceTotal,n.cifPrice),o(r.dutiesTotal,n.priceAfterDuties),o(r.cifLogisticsTotal,n.cifLogisticsTotal),o(r.marginsTotal,n.totalMargins),o(r.pricePerUnit,n.pricePerUnit),o(r.pricePerShipment,n.pricePerShipment),o(r.manufacturerMarginValue,n.exworksPrice-n.baseCost),o(r.customDutiesValue,n.customDutiesValue),o(r.exciseTaxValue,n.exciseTaxValue),o(r.importerMarginValue,n.importerMarginValue),o(r.wholesalerMarginValue,n.wholesalerMarginValue),o(r.retailerMarginValue,n.retailerMarginValue)}let calculators=new Set;function createCalculator(){const e=calculators.size,t=0===e?extractTableColumn(containerTable,e+1):cloneTableColumn(containerTable,e),r=captureElements(containerTable,e),n=extractInputs(r),o={column:t,elements:r,inputs:n,outputs:calculateOutputs(n)};return calculators.add(o),renderCalculator(o),attachEventListeners(o),serializeCalculators(calculators),o}function updateCalculator(e){e.inputs=extractInputs(e.elements),e.outputs=calculateOutputs(e.inputs),renderCalculator(e),serializeCalculators(calculators)}function deleteCalculator(e){calculators.size<2?showToast("Cannot delete the last calculator.","#ff6347","white"):(e.column.forEach((e=>{e.remove()})),calculators.delete(e),serializeCalculators(calculators))}const currencies=[{code:"JPY",name:"Japanese Yen"},{code:"USD",name:"US Dollar"},{code:"EUR",name:"Euro"},{code:"GBP",name:"British Pound"},{code:"INR",name:"Indian Rupee"},{code:"CNY",name:"Chinese Yuan"},{code:"CAD",name:"Canadian Dollar"},{code:"AUD",name:"Australian Dollar"},{code:"CHF",name:"Swiss Franc"},{code:"HKD",name:"Hong Kong Dollar"},{code:"SGD",name:"Singapore Dollar"},{code:"MXN",name:"Mexican Peso"},{code:"BRL",name:"Brazilian Real"},{code:"RUB",name:"Russian Ruble"},{code:"ZAR",name:"South African Rand"},{code:"TRY",name:"Turkish Lira"},{code:"SEK",name:"Swedish Krona"},{code:"NOK",name:"Norwegian Krone"},{code:"DKK",name:"Danish Krone"},{code:"NZD",name:"New Zealand Dollar"},{code:"PLN",name:"Polish ZÅ‚oty"},{code:"THB",name:"Thai Baht"},{code:"KRW",name:"South Korean Won"},{code:"IDR",name:"Indonesian Rupiah"},{code:"AED",name:"United Arab Emirates Dirham"},{code:"SAR",name:"Saudi Riyal"},{code:"MYR",name:"Malaysian Ringgit"},{code:"PHP",name:"Philippine Peso"},{code:"VND",name:"Vietnamese Dong"}];function extractTableColumn(e,t){const r=e.querySelectorAll("tr");return Array.from(r).map((e=>e.children[t]))}function cloneTableColumn(e,t){const r=e.querySelectorAll("tr");return Array.from(r).map((e=>{const r=e.children[t],n=r.cloneNode(!0);if(e.classList.contains("name-row")){const e=r.querySelector("input.name-input"),t=n.querySelector("input.name-input");e&&""!==e.value.trim()?t.value=`${e.value} copy`:t.value=""}if(r.querySelector("select")){const e=r.querySelector("select");n.querySelector("select").value=e.value}return e.appendChild(n),n}))}let containerTable;function showToast(e,t,r="black"){Toastify({text:e,duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:t,stopOnFocus:!0,style:{color:r,borderRadius:"0.5rem"},closeOnClick:!0,onClick:function(){}}).showToast();const n=document.querySelector(".toastify");if(n){const e=n.querySelector(".toast-close");e&&(e.style.color=r)}}function debounce(e,t){let r;return function(...n){clearTimeout(r),r=setTimeout((()=>{clearTimeout(r),e(...n)}),t)}}function updateComparisonContainerAndHeaderButtonsPadding(){const e=document.querySelector(".nav-container"),t=document.querySelector(".comparison-container"),r=document.querySelector(".header-buttons");if(window.innerWidth>480){if(e&&t){const r=e.getBoundingClientRect().left;t.style.paddingLeft=`${r}px`}if(e&&r){const t=window.innerWidth-e.getBoundingClientRect().right;r.style.paddingRight=`${t}px`}}else t&&(t.style.paddingLeft="0"),r&&(r.style.paddingRight="0")}document.addEventListener("DOMContentLoaded",(function(){containerTable=document.querySelector("table");const e=deserializeCalculators();if(e.length>0)e.forEach((e=>{const t=createCalculatorWithInputs(e);calculators.add(t)}));else{const e=createCalculator();calculators.add(e)}document.getElementById("compare").addEventListener("click",(function(){const e=createCalculator();calculators.add(e)}))})),document.getElementById("submitEmail").addEventListener("click",(async function(){const e=document.getElementById("userEmail").value;if(!e)return void showToast("Please enter a valid email address.","#ff6347","white");const t=document.createElement("div");t.className="loading-spinner",document.querySelector(".popup-container").appendChild(t);const r=Array.from(calculators).map((e=>({name:e.inputs.name,unitsPerShipment:e.inputs.unitsPerShipment,currency:e.inputs.currency,productionCosts:e.inputs.productionCosts,manufacturerMargin:e.inputs.manufacturerMargin,freightInsurance:e.inputs.freightInsurance,customDuties:e.inputs.customDuties,exciseTax:e.inputs.exciseTax,domesticLogistics:e.inputs.domesticLogistics,storage:e.inputs.storage,importHandling:e.inputs.importHandling,importerMargin:e.inputs.importerMargin,wholesalerMargin:e.inputs.wholesalerMargin,retailerMargin:e.inputs.retailerMargin,pricePerUnit:e.outputs.pricePerUnit,pricePerShipment:e.outputs.pricePerShipment})));try{const n=await fetch("https://excel-generator.flat-salad-5e06.workers.dev",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({calculators:r,email:e})});t.remove(),n.ok?(document.getElementById("userEmail").value="",showToast("Excel file has been sent to your email.","#ffd212")):showToast("Failed to send Excel file. Please try again.","#ff6347","white")}catch(e){console.error("Error sending data:",e),t.remove(),showToast("An error occurred. Please try again.","#ff6347","white")}}));const debouncedUpdatePadding=debounce(updateComparisonContainerAndHeaderButtonsPadding,250);function attachEventListeners(e){Object.values(e.elements).forEach((t=>{(t instanceof HTMLInputElement||t instanceof HTMLSelectElement)&&t.addEventListener("input",(function(){updateCalculator(e)}))})),e.elements.deleteButton.addEventListener("click",(function(){deleteCalculator(e)}))}function serializeCalculators(e){const t=new URLSearchParams,r=["n","c","us","pc","mm","fi","cd","et","dl","s","ih","im","wm","rm"],n={};r.forEach((e=>n[e]=[])),e.forEach((e=>{const t=e.inputs;n.n.push(encodeURIComponent(t.name||"")),n.c.push(encodeURIComponent(t.currency||"USD")),n.us.push(t.unitsPerShipment||""),n.pc.push(t.productionCosts||""),n.mm.push(t.manufacturerMargin||""),n.fi.push(t.freightInsurance||""),n.cd.push(t.customDuties||""),n.et.push(t.exciseTax||""),n.dl.push(t.domesticLogistics||""),n.s.push(t.storage||""),n.ih.push(t.importHandling||""),n.im.push(t.importerMargin||""),n.wm.push(t.wholesalerMargin||""),n.rm.push(t.retailerMargin||"")})),r.forEach((e=>{const r=n[e];r.some((e=>""!==e))&&t.set(e,r.join(","))})),window.history.replaceState(null,"",`${window.location.pathname}?${t.toString()}`)}function deserializeCalculators(){const e=new URLSearchParams(window.location.search),t=["n","c","us","pc","mm","fi","cd","et","dl","s","ih","im","wm","rm"],r={};t.forEach((t=>{const n=e.get(t);r[t]=null!==n?n.split(",").map(decodeURIComponent):[]}));const n=Math.max(...t.map((e=>r[e].length))),o=[];for(let e=0;e<n;e++){const t={name:r.n[e]||"",currency:r.c[e]||"USD",unitsPerShipment:parseFloat(r.us[e])||0,productionCosts:parseFloat(r.pc[e])||0,manufacturerMargin:parseFloat(r.mm[e])||0,freightInsurance:parseFloat(r.fi[e])||0,customDuties:parseFloat(r.cd[e])||0,exciseTax:parseFloat(r.et[e])||0,domesticLogistics:parseFloat(r.dl[e])||0,storage:parseFloat(r.s[e])||0,importHandling:parseFloat(r.ih[e])||0,importerMargin:parseFloat(r.im[e])||0,wholesalerMargin:parseFloat(r.wm[e])||0,retailerMargin:parseFloat(r.rm[e])||0};o.push(t)}return o}function createCalculatorWithInputs(e){const t=calculators.size,r=0===t?extractTableColumn(containerTable,t+1):cloneTableColumn(containerTable,t),n=captureElements(containerTable,t);Object.keys(e).forEach((t=>{n[t]&&(n[t]instanceof HTMLInputElement||n[t]instanceof HTMLSelectElement)&&(n[t].value=e[t])}));const o=calculateOutputs(e),i={column:r,elements:n,inputs:e,outputs:o};return renderCalculator(i),attachEventListeners(i),i}function closeSharePopup(){document.querySelector(".share-popup").style.display="none"}function openSharePopup(){document.querySelector(".share-popup").style.display="flex";const e=window.location.href;document.querySelector(".url-text").textContent=e}function handleCopyButtonClick(e){e.disabled=!0,navigator.clipboard.writeText(window.location.href).then((()=>{e.textContent="Copied",setTimeout((()=>{e.textContent="Copy",e.disabled=!1}),2e3)})).catch((t=>{console.error("Copy to clipboard failed:",t),showToast("Failed to copy URL. Please try again.","#ff6347","white"),e.disabled=!1}))}function handleShareClick(e){const t=encodeURIComponent(window.location.href),r=encodeURIComponent(document.title);let n="";switch(e){case"x":n=`https://twitter.com/intent/tweet?url=${t}&text=${r}`;break;case"facebook":n=`https://www.facebook.com/sharer/sharer.php?u=${t}`;break;case"linkedin":n=`https://www.linkedin.com/shareArticle?mini=true&url=${t}&title=${r}`;break;case"email":n=`mailto:?subject=${r}&body=${encodeURIComponent("Calculator Link: ")+t}`;break;default:return void showToast("Unsupported sharing platform.","#ff6347","white")}window.open(n,"_blank","noopener,noreferrer")}function initializeShareButtons(){document.querySelectorAll("[share-link]").forEach((e=>{const t=e.getAttribute("share-link");e.addEventListener("click",(()=>{handleShareClick(t)}))}))}function setCookie(e,t,r){const n=r?`; expires=${new Date(Date.now()+864e5*r).toUTCString()}`:"";document.cookie=`${e}=${encodeURIComponent(t)}${n}; path=/`}function getCookie(e){return document.cookie.split("; ").reduce(((t,r)=>{const n=r.split("=");return n[0]===e?decodeURIComponent(n[1]):t}),"")}function showHowToUsePopup(){const e=document.querySelector(".how-to-use-popup");e&&(e.style.display="flex")}function hideHowToUsePopup(){const e=document.querySelector(".how-to-use-popup");e&&(e.style.display="none",setCookie("howToUseShown","true",365))}function initializeHowToUsePopup(){getCookie("howToUseShown")||showHowToUsePopup();const e=document.querySelector(".how-to-use-close");e&&e.addEventListener("click",hideHowToUsePopup);const t=document.getElementById("how-to-use");t&&t.addEventListener("click",showHowToUsePopup)}document.addEventListener("DOMContentLoaded",(()=>{updateComparisonContainerAndHeaderButtonsPadding(),window.addEventListener("resize",debouncedUpdatePadding)})),document.querySelector(".close").addEventListener("click",closeSharePopup),document.querySelector(".share-button").addEventListener("click",openSharePopup),document.querySelector(".copy-button").addEventListener("click",(function(){handleCopyButtonClick(this)})),document.addEventListener("DOMContentLoaded",(()=>{initializeShareButtons()})),document.addEventListener("DOMContentLoaded",(()=>{initializeShareButtons(),initializeHowToUsePopup()}));